{
  "entities": {
    "Organization": {
      "title": "Organization",
      "description": "Represents a microfinancing organization tenant in the system.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "logoUrl": { "type": "string", "format": "uri" },
        "slogan": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "name", "createdAt"]
    },
    "User": {
      "title": "User",
      "description": "Represents a user of the application.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity, matches Firebase Auth UID."
        },
        "organizationId": {
            "type": "string",
            "description": "The ID of the organization the user belongs to."
        },
        "fullName": {
          "type": "string",
          "description": "The full name of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "roleId": {
            "type": "string",
            "description": "The ID of the role assigned to the user (e.g., superadmin, admin, manager)."
        },
        "branchIds": {
            "type": "array",
            "items": { "type": "string" },
            "description": "An array of branch IDs the user is associated with."
        },
        "status": {
            "type": "string",
            "enum": ["active", "suspended"],
            "description": "The status of the user account."
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the user was created."
        },
        "avatarUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        },
        "marketingOptIn": {
          "type": "boolean",
          "description": "Whether the user has opted in to marketing communications."
        }
      },
      "required": ["id", "email", "fullName", "roleId", "status", "organizationId", "createdAt"]
    },
    "Role": {
        "title": "Role",
        "description": "Defines a user role and its associated permissions.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "organizationId": { "type": "string" },
            "name": { "type": "string" },
            "systemRole": { "type": "boolean" },
            "permissions": {
                "type": "array",
                "items": { "type": "string" }
            }
        },
        "required": ["id", "name", "systemRole", "permissions"]
    },
    "AuditLog": {
        "title": "Audit Log",
        "description": "Logs administrative actions performed on users.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "action": { "type": "string" },
            "performedBy": { "type": "string" },
            "targetUserId": { "type": "string" },
            "organizationId": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" }
        },
        "required": ["id", "action", "performedBy", "organizationId", "timestamp"]
    },
    "Branch": {
        "title": "Branch",
        "description": "Represents a physical branch of the organization.",
        "type": "object",
        "properties": {
            "id": { "type": "string" },
            "organizationId": { "type": "string" },
            "name": { "type": "string" },
            "location": { "type": "string" },
            "isMain": { "type": "boolean" }
        },
        "required": ["id", "organizationId", "name", "location", "isMain"]
    },
    "Borrower": {
      "title": "Borrower",
      "description": "Represents a borrower in the microfinancing system.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "fullName": { "type": "string" },
        "dateOfBirth": { "type": "string", "format": "date" },
        "gender": { "type": "string", "enum": ["Male", "Female", "Other"] },
        "nationalId": { "type": "string" },
        "phone": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "address": { "type": "string" },
        "employmentStatus": { "type": "string", "enum": ["Employed", "Self-employed", "Unemployed"] },
        "monthlyIncome": { "type": "number" },
        "photoUrl": { "type": "string", "format": "uri" },
        "businessPhotoUrl": { "type": "string", "format": "uri" },
        "homeAssetsPhotoUrl": { "type": "string", "format": "uri" },
        "branchId": { "type": "string" },
        "userId": { "type": "string" },
        "registrationFeeRequired": { "type": "boolean", "default": true },
        "registrationFeeAmount": { "type": "number", "default": 800 },
        "registrationFeePaid": { "type": "boolean", "default": false },
        "registrationFeePaidAt": { "type": "string", "format": "date-time", "nullable": true },
        "registrationPaymentId": { "type": "string", "nullable": true }
      },
      "required": [
        "id",
        "organizationId",
        "fullName",
        "nationalId",
        "phone",
        "branchId",
        "userId",
        "registrationFeePaid"
      ]
    },
    "Loan": {
      "title": "Loan",
      "description": "Represents a loan in the microfinancing system.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "borrowerId": { "type": "string" },
        "loanProductId": { "type": "string" },
        "principal": { "type": "number" },
        "interestRate": { "type": "number" },
        "totalPayable": { "type": "number" },
        "installmentAmount": { "type": "number" },
        "duration": { "type": "number" },
        "issueDate": { "type": "string", "format": "date" },
        "status": { "type": "string", "enum": ["Draft", "Pending Approval", "Approved", "Active", "Completed", "Rejected"] },
        "loanOfficerId": { "type": "string" },
        "branchId": { "type": "string" },
        "lastPaymentDate": { "type": "string", "format": "date-time" }
      },
      "required": [
        "id",
        "organizationId",
        "borrowerId",
        "loanProductId",
        "principal",
        "issueDate",
        "loanOfficerId",
        "branchId",
        "status",
        "duration",
        "interestRate",
        "totalPayable",
        "installmentAmount"
      ]
    },
    "LoanProduct": {
      "title": "Loan Product",
      "description": "Defines a type of loan product offered.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "name": { "type": "string" },
        "category": { "type": "string" },
        "minAmount": { "type": "number" },
        "maxAmount": { "type": "number" },
        "interestRate": { "type": "number" },
        "duration": { "type": "number" },
        "repaymentCycle": { "type": "string", "enum": ["Weekly", "Monthly"] },
        "processingFee": { "type": "number" }
      },
      "required": [
        "id",
        "organizationId",
        "name",
        "interestRate",
        "duration",
        "minAmount",
        "maxAmount",
        "repaymentCycle"
      ]
    },
    "Installment": {
      "title": "Installment",
      "description": "Represents a single repayment installment for a loan.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "loanId": { "type": "string" },
        "organizationId": { "type": "string" },
        "branchId": { "type": "string" },
        "installmentNumber": { "type": "number" },
        "dueDate": { "type": "string", "format": "date" },
        "expectedAmount": { "type": "number" },
        "paidAmount": { "type": "number" },
        "status": { "type": "string", "enum": ["Paid", "Unpaid", "Partial", "Overdue"] }
      },
      "required": ["id", "loanId", "organizationId", "branchId", "dueDate", "expectedAmount", "installmentNumber", "paidAmount", "status"]
    },
    "Repayment": {
      "title": "Repayment",
      "description": "Represents a payment made for a loan.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "loanId": { "type": "string" },
        "borrowerId": { "type": "string" },
        "transId": { "type": "string" },
        "amount": { "type": "number" },
        "paymentDate": { "type": "string", "format": "date" },
        "collectedById": { "type": "string" },
        "method": { "type": "string", "enum": ["Cash", "Bank Transfer", "Mobile Money"] },
        "phone": { "type": "string" },
        "balanceAfterPayment": { "type": "number" }
      },
      "required": ["id", "organizationId", "loanId", "borrowerId", "amount", "paymentDate", "collectedById", "transId"]
    },
    "RegistrationPayment": {
      "title": "Registration Payment",
      "description": "Represents a one-time registration fee payment for a borrower.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "organizationId": { "type": "string" },
        "borrowerId": { "type": "string" },
        "amount": { "type": "number" },
        "currency": { "type": "string", "default": "KES" },
        "paymentMethod": { "type": "string", "enum": ["Cash", "Bank Transfer", "Mobile Money"] },
        "reference": { "type": "string" },
        "collectedBy": { "type": "string" },
        "createdAt": { "type": "string", "format": "date-time" },
        "status": { "type": "string", "enum": ["confirmed"], "default": "confirmed" }
      },
      "required": ["id", "organizationId", "borrowerId", "amount", "paymentMethod", "collectedBy", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/organizations/{organizationId}",
        "definition": {
          "entityName": "Organization",
          "schema": { "$ref": "#/backend/entities/Organization" },
          "description": "Stores details for each tenant organization."
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": { "$ref": "#/backend/entities/User" },
          "description": "Stores user data, including roles and permissions."
        }
      },
       {
        "path": "/roles/{roleId}",
        "definition": {
          "entityName": "Role",
          "schema": { "$ref": "#/backend/entities/Role" },
          "description": "Stores role definitions and permissions."
        }
      },
      {
        "path": "/branches/{branchId}",
        "definition": {
          "entityName": "Branch",
          "schema": { "$ref": "#/backend/entities/Branch" },
          "description": "Stores organization branch information."
        }
      },
      {
        "path": "/auditLogs/{logId}",
        "definition": {
          "entityName": "AuditLog",
          "schema": { "$ref": "#/backend/entities/AuditLog" },
          "description": "Stores audit trails for important user actions."
        }
      },
      {
        "path": "/borrowers/{borrowerId}",
        "definition": {
          "entityName": "Borrower",
          "schema": { "$ref": "#/backend/entities/Borrower" },
          "description": "Stores information about individual borrowers."
        }
      },
      {
        "path": "/loans/{loanId}",
        "definition": {
          "entityName": "Loan",
          "schema": { "$ref": "#/backend/entities/Loan" },
          "description": "Stores individual loan records."
        }
      },
      {
        "path": "/loans/{loanId}/installments/{installmentId}",
        "definition": {
          "entityName": "Installment",
          "schema": { "$ref": "#/backend/entities/Installment" },
          "description": "Stores installments for a specific loan."
        }
      },
      {
        "path": "/loanProducts/{loanProductId}",
        "definition": {
          "entityName": "LoanProduct",
          "schema": { "$ref": "#/backend/entities/LoanProduct" },
          "description": "Stores loan product definitions."
        }
      },
      {
        "path": "/repayments/{repaymentId}",
        "definition": {
          "entityName": "Repayment",
          "schema": { "$ref": "#/backend/entities/Repayment" },
          "description": "Stores repayment records."
        }
      },
      {
        "path": "/registrationPayments/{paymentId}",
        "definition": {
            "entityName": "RegistrationPayment",
            "schema": { "$ref": "#/backend/entities/RegistrationPayment" },
            "description": "Stores one-time registration fee payment records for borrowers."
        }
      }
    ]
  }
}
